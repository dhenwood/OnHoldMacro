import xapi from 'xapi';

const blueImage = "iVBORw0KGgoAAAANSUhEUgAAA8AAAAIcCAIAAAC2P1AsAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSoVBzuoKGSoTnZREd1qFYpQIdQKrTqYXPoFTRqSFhdHwbXg4Mdi1cHFWVcHV0EQ/ABxdnBSdJES/5cUWsR4cNyPd/ced+8AoV5imtURBTS9YibjMTGdWRUDr+jGIIBZjMjMMuYkKQHP8XUPH1/vIjzL+9yfo1fNWgzwicRRZpgV4g3i6c2KwXmfOMQKskp8Tjxu0gWJH7muuPzGOe+wwDNDZio5TxwiFvNtrLQxK5ga8RRxWNV0yhfSLquctzhrpSpr3pO/MJjVV5a5TnMYcSxiCRJEKKiiiBIqiNCqk2IhSfsxD/+Q45fIpZCrCEaOBZShQXb84H/wu1srNznhJgVjQOeLbX+MAoFdoFGz7e9j226cAP5n4Epv+ct1YOaT9FpLCx8BfdvAxXVLU/aAyx1g4MmQTdmR/DSFXA54P6NvygD9t0DPmttbcx+nD0CKukrcAAeHwFiestc93t3V3tu/Z5r9/QDJk3LJxVsCqQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+gJGgACHCJA2AgAAACRdEVYdENvbW1lbnQAU3lkbmV5LCBOZXcgU291dGggV2FsZXMgLyBBdXN0cmFsaWEgLSBNYXkgMTd0aCAyMDE2OiBXaWRlIHNob3Qgb2YgU3lkbmV5IE9wZXJhIEhvdXNlIGFuZCBIYXJib3VyIEJyaWRnZSwgc2lsaG91ZXR0ZWQgYWdhaW5zdCBhIHN1bnNldCBza3nzGjKGAAAJRElEQVR42u3WMREAMAgAsdIVb/h3gQUsMHOJhJ8+svoBAAA7XwIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAAAMNAAAGWgIAADDQAABgoAEAwEADAICBBgAAAw0AAAZaAgAAMNAAAGCgAQDAQAMAgIEGAAADDQAABloCAAAw0AAAYKABAMBAAwCAgQYAgJsGpY8FgNloCAMAAAAASUVORK5CYII="

function turnOnHoldState(){
  xapi.Config.UserInterface.LedControl.Mode.set("Manual");
  xapi.Command.UserInterface.LedControl.Color.Set({ Color: "Blue" });
  setTimeout(turnOffHoldState, 180000); // Hold timer for 3 minutes
  xapi.Command.UserInterface.Branding.Upload({Type: "SchedulerBackground" }, blueImage);
  xapi.Command.UserInterface.Translation.Override.Set({}, '{"version": 1, "translations": [{"sourceText": "Available", "translated": "On Hold", "language": "English"}]}');
}

function turnOffHoldState(){
  xapi.Config.UserInterface.LedControl.Mode.set("Auto");
  xapi.Command.UserInterface.Branding.Delete({ Type: "SchedulerBackground" });
  xapi.Command.UserInterface.Translation.Override.Set({}, '{"version": 1, "translations": [{"sourceText": "On Hold", "translated": "Available", "language": "English"}]}');
}

function changeWallpaper(color){
  if (color == "Blue"){
    xapi.Command.UserInterface.Branding.Upload({Type: "SchedulerBackground" }, blueImage);
  }
}

// Track when someone puts room "On Hold" in Cisco Spaces
xapi.event.on('UserInterface Message Prompt Display', (value) => {
  if (value.Title == "Cisco Spaces Smart Workspaces"){
    turnOnHoldState();
  }
});

// Track when someone books the room - specifically pressing 'Book Room' button from outside Nav when currently OnHold
xapi.event.on('Bookings BookingRequested', () => {
  turnOffHoldState()
})

// Track when LED state changes - used for changing the wallpaper
xapi.Status.UserInterface.LedControl.Color.on(color => 
  changeWallpaper(color)
);
